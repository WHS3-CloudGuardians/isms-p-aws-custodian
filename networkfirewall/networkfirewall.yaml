policies:

# CHECKID: networkfirewall_in_all_vpc
# ACTIONPLAN: 네트워크 방화벽이 없는 VPC는 방화벽을 배포하여 인바운드 및 아웃바운드 트래픽을 필터링합니다.
  - name: networkfirewall_in_all_vpc
    description: Alert on VPCs without AWS Network Firewall deployed
    resource: aws.vpc
    mode:
      type: periodic
      schedule: "rate(7 days)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - type: value
        key: VpcId
        op: not-in
        value:
          - type: resource
            resource: aws.network-firewall
            field: VpcId
    actions:
      - type: notify
        slack_template: slack_default
        slack_msg_color: danger
        violation_desc: |
          *** CHECKID: networkfirewall_in_all_vpc ***
          • 네트워크 방화벽이 배포되지 않은 VPC가 감지되었습니다.
        action_desc: |
          1. 해당 VPC에 AWS Network Firewall을 생성하여 인바운드 및 아웃바운드 트래픽을 필터링하세요.
          2. 방화벽 정책이 올바르게 적용되었는지 주기적으로 검토하세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-notify-queue
