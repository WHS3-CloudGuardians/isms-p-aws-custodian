policies:
  # accessanalyzer_enabled
  # ISMS-P: 2.3.6 
  # PURPOSE: Ensure AWS Access Analyzer is enabled
  # ACTION PLAN: Invoke remediation Lambda, then send Slack notification
  - name: accessanalyzer_enabled
    description: |
      If AWS Access Analyzer is not active, automatically invoke a Lambda to enable it and send a Slack notification.
      This supports ISMS-P 2.3.6 controls for external connection management.
    resource: aws.account
    mode:
      type: periodic
      schedule: "rate(5 minutes)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - type: access-analyzer
        key: status
        op: ne
        value: ACTIVE
    actions:
      - type: invoke-lambda
        function: arn:aws:lambda:ap-northeast-2:311278774159:function:accessanalyzer_enabled
      - type: notify
        template: default
        template_format: slack
        violation_desc: |
          *** CHECKID: accessanalyzer_enabled ***
          • AWS Access Analyzer가 활성화되어 있지 않습니다.
        action_desc: |
          1. AWS Console에서 Access Analyzer를 직접 활성화(Enable)해 주세요.
          2. 외부 접근 통제 및 ISMS-P 준수를 위해 항상 활성화 상태를 유지해 주세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-mailer-queue
