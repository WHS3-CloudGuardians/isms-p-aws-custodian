# 자동 조치 X / 알림만
# 위반 사항 : Route53 공개 호스티드 존에 대해 CloudWatch Query Logging이 비활성화됨
# 이유 : Cloud Custodian에서는 Route53 Query Logging을 직접적으로 활성화하는 API 호출을 지원하지 않음.

policies:
  - name: alert-route53-public-zone-query-logging-disabled
    resource: aws.route53-hostedzone  
    description: >
      Query Logging이 꺼진 공개 Route53 호스티드 존에 대해 Slack 알림 전송.
      ISMS-P 2.9.4 로그 및 접속기록 관리 기준 위반 사항 알림 목적

    mode:
      type: periodic                    
      schedule: "rate(1 day)"         
      role: arn:aws:iam::311278774159:role/custodian-lambda-role  

    filters:
      - ConfigPublicZone: true        
      - type: query-logging-enabled    
        enabled: false

    actions:
      - type: notify               
        template: default
        to:
          - slack
        transport:
          type: webhook
          webhook: https://hooks.slack.com/services/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
