policies:
# CHECKID: eventbridge_bus_cross_account_access
# ACTIONPLAN: EventBridge 버스에 크로스 계정 접근이 허용된 구성을 탐지하고 관리자에게 알림을 전송하거나 위험 리소스로 태깅
  - name: eventbridge-bus-cross-account-access
    resource: aws.event-bus
    description: "Alert: eventbridge bus cross account access"
    mode:
      type: periodic
      schedule: "rate(5 minutes)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - type: cross-account
    actions:
      - type: tag
        key: "Risk"
        value: "CrossAccountOrPublic"
      - type: notify
        template: default
        template_format: slack
        violation_desc: |
          *** CHECKID: eventbridge_bus_cross_account_access ***
          • 크로스 계정 접근이 가능한 EventBridge 버스가 감지되었습니다.
        action_desc: |
          1. EventBridge 버스에 대한 접근 정책 점검해주세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-notify-queue


# CHECKID: eventbridge_bus_exposed
# ACTIONPLAN: 크로스 계정이나 외부 노출이 가능한 EventBridge 버스를 탐지하고 경고 또는 접근 정책 점검을 유도
  - name: eventbridge-bus-exposed
    resource: aws.event-bus
    description: "Alert: eventbridge bus exposed"
    mode:
      type: periodic
      schedule: "rate(5 minutes)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - type: cross-account
        actions: 
          - "events:PutEvents"
    actions:
      - type: notify
        template: default
        template_format: slack
        violation_desc: |
          *** CHECKID: eventbridge_bus_exposed ***
          • 외부 노출이 가능한 EventBridge 버스가 감지되었습니다.
        action_desc: |
          1. EventBridge 버스에 대한 접근 정책 점검해주세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-notify-queue
