policies:

  # CHECKID: glue_etl_jobs_amazon_s3_encryption_enabled
  - name: glue_etl_jobs_amazon_s3_encryption_enabled
    resource: aws.glue-security-configuration
    description: |
      Detect Glue Security Configurations where Amazon S3 encryption is not enabled.
    mode:
      type: periodic
      schedule: "rate(1 day)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - or:
          - type: value
            key: EncryptionConfiguration.S3Encryptions[0].S3EncryptionMode
            value: DISABLED
          - type: value
            key: EncryptionConfiguration.S3Encryptions[0].S3EncryptionMode
            value: null
    actions:
      - type: notify
        template: default
        template_format: slack
        violation_desc: |
          *** CHECKID: glue_etl_jobs_amazon_s3_encryption_enabled ***
          • Glue Security Configuration에서 S3 암호화가 활성화되어 있지 않습니다.
        action_desc: |
          1. Security Configuration에 S3 암호화(SSE-S3, SSE-KMS 등)를 반드시 적용하세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-notify-queue

  # CHECKID: glue_etl_jobs_cloudwatch_logs_encryption_enabled
  - name: glue_etl_jobs_cloudwatch_logs_encryption_enabled
    resource: aws.glue-security-configuration
    description: |
      Detect Glue Security Configurations where CloudWatch Logs encryption is not enabled.
    mode:
      type: periodic
      schedule: "rate(1 day)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - or:
          - type: value
            key: EncryptionConfiguration.CloudWatchEncryption.CloudWatchEncryptionMode
            value: DISABLED
          - type: value
            key: EncryptionConfiguration.CloudWatchEncryption.CloudWatchEncryptionMode
            value: null
    actions:
      - type: notify
        template: default
        template_format: slack
        violation_desc: |
          *** CHECKID: glue_etl_jobs_cloudwatch_logs_encryption_enabled ***
          • Glue Security Configuration에서 CloudWatch 로그 암호화가 활성화되어 있지 않습니다.
        action_desc: |
          1. Security Configuration에 CloudWatch 로그 암호화(KMS 등)를 반드시 적용하세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-notify-queue

  # CHECKID: glue_etl_jobs_job_bookmark_encryption_enabled
  - name: glue_etl_jobs_job_bookmark_encryption_enabled
    resource: aws.glue-security-configuration
    description: |
      Detect Glue Security Configurations where Job Bookmark encryption is not enabled.
    mode:
      type: periodic
      schedule: "rate(1 day)"
      role: arn:aws:iam::311278774159:role/custodian-lambda-role
    filters:
      - or:
          - type: value
            key: EncryptionConfiguration.JobBookmarksEncryption.JobBookmarksEncryptionMode
            value: DISABLED
          - type: value
            key: EncryptionConfiguration.JobBookmarksEncryption.JobBookmarksEncryptionMode
            value: null
    actions:
      - type: notify
        template: default
        template_format: slack
        violation_desc: |
          *** CHECKID: glue_etl_jobs_job_bookmark_encryption_enabled ***
          • Glue Security Configuration에서 Job Bookmark 암호화가 활성화되어 있지 않습니다.
        action_desc: |
          1. Security Configuration에 Job Bookmark 암호화(KMS 등)를 반드시 적용하세요.
        to:
          - https://hooks.slack.com/services/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
        transport:
          type: sqs
          queue: https://sqs.ap-northeast-2.amazonaws.com/311278774159/custodian-notify-queue
